import{d as R,u as pe,c as b,o as r,a as p,b as a,e as P,F as X,f as t,r as I,t as m,h as j,n as Z,j as T,q as fe,m as ve,g as he,v as ge,x as me,y as xe,z as we,A as ye,k as K,w as E,G as J,_ as G,D as _e,C as ke}from"./index-248db249.js";import{i as be,d as W,N as Q,M as Ce,H as N,m as Me,a as Be,u as Te,b as Ae,e as Le,f as Ie,_ as $e,g as De}from"./index-5c5f7994.js";const Oe={key:1,class:"text-[28px] dark:text-white"},Re=t("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32","aria-hidden":"true",width:"1em",height:"1em"},[t("path",{d:"M29.71,13.09A8.09,8.09,0,0,0,20.34,2.68a8.08,8.08,0,0,0-13.7,2.9A8.08,8.08,0,0,0,2.3,18.9,8,8,0,0,0,3,25.45a8.08,8.08,0,0,0,8.69,3.87,8,8,0,0,0,6,2.68,8.09,8.09,0,0,0,7.7-5.61,8,8,0,0,0,5.33-3.86A8.09,8.09,0,0,0,29.71,13.09Zm-12,16.82a6,6,0,0,1-3.84-1.39l.19-.11,6.37-3.68a1,1,0,0,0,.53-.91v-9l2.69,1.56a.08.08,0,0,1,.05.07v7.44A6,6,0,0,1,17.68,29.91ZM4.8,24.41a6,6,0,0,1-.71-4l.19.11,6.37,3.68a1,1,0,0,0,1,0l7.79-4.49V22.8a.09.09,0,0,1,0,.08L13,26.6A6,6,0,0,1,4.8,24.41ZM3.12,10.53A6,6,0,0,1,6.28,7.9v7.57a1,1,0,0,0,.51.9l7.75,4.47L11.85,22.4a.14.14,0,0,1-.09,0L5.32,18.68a6,6,0,0,1-2.2-8.18Zm22.13,5.14-7.78-4.52L20.16,9.6a.08.08,0,0,1,.09,0l6.44,3.72a6,6,0,0,1-.9,10.81V16.56A1.06,1.06,0,0,0,25.25,15.67Zm2.68-4-.19-.12-6.36-3.7a1,1,0,0,0-1.05,0l-7.78,4.49V9.2a.09.09,0,0,1,0-.09L19,5.4a6,6,0,0,1,8.91,6.21ZM11.08,17.15,8.38,15.6a.14.14,0,0,1-.05-.08V8.1a6,6,0,0,1,9.84-4.61L18,3.6,11.61,7.28a1,1,0,0,0-.53.91ZM12.54,14,16,12l3.47,2v4L16,20l-3.47-2Z",fill:"currentColor"})],-1),Se=[Re],Fe=R({__name:"Avatar",props:{image:{type:Boolean}},setup(i){const f=pe(),c=b(()=>f.userInfo.avatar);return(C,v)=>i.image?(r(),p(X,{key:0},[a(be)(a(c))&&a(c).length>0?(r(),P(a(Q),{key:0,src:a(c),"fallback-src":a(W)},null,8,["src","fallback-src"])):(r(),P(a(Q),{key:1,round:"",src:a(W)},null,8,["src"]))],64)):(r(),p("span",Oe,Se))}}),ze={key:0,class:"dark:text-white w-[4px] h-[20px] block animate-blink"},qe={key:0},Ee=["innerHTML"],Ne=["textContent"],Pe=["textContent"],Ze=R({__name:"Text",props:{inversion:{type:Boolean},error:{type:Boolean},text:null,loading:{type:Boolean},asRawText:{type:Boolean}},setup(i,{expose:f}){const c=i,C=I(),v=new Ce({linkify:!0,highlight(u,w){if(!!(w&&N.getLanguage(w))){const $=w??"";return M(N.highlight(u,{language:$}).value,$)}return M(N.highlightAuto(u).value,"")}});v.use(Me,{attrs:{target:"_blank",rel:"noopener"}}),v.use(Be,{blockClass:"katexmath-block rounded-md p-[10px]",errorColor:" #cc0000"});const A=b(()=>["text-wrap","min-w-[20px]","rounded-md",c.inversion?"dark:bg-[#a1dc95]":"dark:bg-[#1e1e20]",c.inversion?"message-request":"message-reply",{"text-red-500":c.error}]),L=b(()=>{const u=c.text??"";return c.asRawText?u:v.render(u)});function M(u,w){return`<pre class="code-block-wrapper"><div class="code-block-header"><span class="code-block-header__lang">${w}</span><span class="code-block-header__copy">${m("chat.copyCode")}</span></div><code class="hljs code-block-body ${w}">${u}</code></pre>`}return f({textRef:C}),(u,w)=>(r(),p("div",{class:Z(["text-black",a(A)])},[i.loading?(r(),p("span",ze)):(r(),p("div",{key:1,ref_key:"textRef",ref:C,class:"leading-relaxed break-words"},[i.inversion?(r(),p("div",{key:1,class:"whitespace-pre-wrap",textContent:j(a(L))},null,8,Pe)):(r(),p("div",qe,[i.asRawText?(r(),p("div",{key:1,class:"whitespace-pre-wrap",textContent:j(a(L))},null,8,Ne)):(r(),p("div",{key:0,class:"markdown-body",innerHTML:a(L)},null,8,Ee))]))],512))],2))}});const He={class:"flex items-center justify-center flex-shrink-0 h-8 overflow-hidden rounded-full basis-8 mr-2"},Ue={class:"overflow-hidden text-sm items-start"},Ve={class:"flex items-end gap-1 pt-1 flex-row"},je=R({__name:"index",props:{dateTime:null,text:null,inversion:{type:Boolean},error:{type:Boolean},loading:{type:Boolean}},setup(i){const f=i,c=I(),C=I(f.inversion),v=I();return(A,L)=>(r(),p("div",{ref_key:"messageRef",ref:v,class:Z(["flex w-full overflow-hidden p-4",i.inversion?"bg-[#F5F5F5]":"bg-[#F7FEE7]"])},[t("div",He,[T(Fe,{image:i.inversion},null,8,["image"])]),t("div",Ue,[t("div",Ve,[T(Ze,{ref_key:"textRef",ref:c,inversion:!1,error:i.error,text:i.text,loading:i.loading,"as-raw-text":C.value},null,8,["error","text","loading","as-raw-text"])])])],2))}}),Ke={class:"flex flex-col max-w-2xl mx-auto h-full bg-gray-50"},Je=t("div",{class:"p-5 bg-gray-100"},[t("svg",{t:"1678542002858",class:"icon float-left",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"2324",width:"60",height:"60"},[t("path",{d:"M511.997637 2.142564C229.818192 2.142564 1.065022 230.895734 1.065022 513.075179a510.932615 510.932615 0 0 0 480.147352 509.955304l1.854383 0.100237a511.007792 511.007792 0 0 0 284.422246-67.659917q18.5313-10.687761 35.922405-22.778839c1.741616-1.252961 3.483233-2.430745 5.212319-3.671177l2.806634-2.017268 0.200474-0.137826a510.945144 510.945144 0 0 0 211.299417-413.790514C1022.930252 230.895734 794.189612 2.142564 511.997637 2.142564z",fill:"#F5D762","p-id":"2325"}),t("path",{d:"M298.242416 305.634883m161.606966 0l102.755367 0q161.606966 0 161.606966 161.606966l0 5.061965q0 161.606966-161.606966 161.606966l-102.755367 0q-161.606966 0-161.606966-161.606966l0-5.061965q0-161.606966 161.606966-161.606966Z",fill:"#7F6152","p-id":"2326"}),t("path",{d:"M603.238289 1015.901133a518.300028 518.300028 0 0 1-182.481304 0V774.229931H603.238289z m0 0",fill:"#FCE9E9","p-id":"2327"}),t("path",{d:"M603.238289 778.001345H420.807103v70.16584c19.15778 18.794422 52.62438 31.324036 90.66429 31.324036a158.22397 158.22397 0 0 0 48.364311-7.304765l-76.768947 150.981853a509.955305 509.955305 0 0 0 120.171532-7.392472v-166.643871l-1.252962-1.027429 1.252962-1.252961z",fill:"#FAD5D5","p-id":"2328"}),t("path",{d:"M214.669888 928.657428L420.807103 848.367659l33.829959 172.445083a508.376573 508.376573 0 0 1-239.854408-92.155314z",fill:"#FCE9E9","p-id":"2329"}),t("path",{d:"M569.245445 1020.812742l33.992844-172.445083 206.074567 80.289769a509.115821 509.115821 0 0 1-240.067411 92.155314z",fill:"#FAD5D5","p-id":"2330"}),t("path",{d:"M603.238289 827.844151l-122.025915 195.223921a510.732141 510.732141 0 0 0 286.25157-67.522091q18.5313-10.687761 35.922405-22.778839c1.741616-1.252961 3.483233-2.430745 5.212319-3.671177l2.806634-2.017268 0.200474-0.137826z",fill:"#E3B765","p-id":"2331"}),t("path",{d:"M300.084269 530.629168c-5.362675-144.842342 94.335467-225.207289 211.750483-225.207288 116.888772 0 216.373911 80.790953 211.750483 221.987178 6.953936-4.109714 17.378575-9.10903 29.444593-2.505923 14.546882 7.943776 15.223481 78.021909-5.149671 121.762792a65.31688 65.31688 0 0 0-6.064333 22.678602c-4.397895 58.889188-7.981364 108.030335-21.989474 108.030335-15.035537 0-13.63222-106.025597-13.544513-106.263659-38.00232 101.489876-116.96395 168.022129-194.2842 168.022128-77.896613 0-146.283248-57.448282-188.244926-152.861295-0.676599 0.3383-5.287497 97.104511-17.817112 97.104511-11.577364 0-13.920402-61.958943-14.208583-112.0774a33.278656 33.278656 0 0 0-6.390103-19.546198c-28.003688-38.177735-34.055492-120.823071-16.940039-126.436339a34.556676 34.556676 0 0 1 31.687395 5.312556z",fill:"#F9E3E6","p-id":"2332"}),t("path",{d:"M494.894713 486.875755a17.102924 17.102924 0 1 0 8.607845-14.810004 17.115453 17.115453 0 0 0-8.545197 14.810004z m0 0M511.822222 758.831035c19.846909 0 35.934934-6.477811 35.934934-14.446645H475.937407c0 7.968835 16.050436 14.446645 35.884815 14.446645z",fill:"#D16279","p-id":"2333"}),t("path",{d:"M275.150336 554.197373a11.026061 11.026061 0 0 1 17.428694-8.495078c3.946829 2.9194 6.953936 7.580417 8.13172 16.163202 2.505923 18.167941-2.505923 30.346726-2.505923 30.346726a70.679555 70.679555 0 0 1 9.397211 26.663019 112.766529 112.766529 0 0 1 0 27.565152s-26.31219-16.188262-30.697556-53.513983a236.133112 236.133112 0 0 1-1.754146-38.729038zM748.656993 554.197373c-0.413477-8.77073-10.39958-13.694869-17.416164-8.495078-3.959358 2.9194-6.953936 7.580417-8.144249 16.163202-2.505923 18.167941 2.505923 30.346726 2.505923 30.346726a70.679555 70.679555 0 0 0-9.397211 26.663019 112.766529 112.766529 0 0 0 0 27.565152s26.31219-16.188262 30.697555-53.513983a236.133112 236.133112 0 0 0 1.754146-38.729038z",fill:"#F2B2B1","p-id":"2334"}),t("path",{d:"M724.211715 480.109763v48.865496a115.360159 115.360159 0 0 0-110.035073-80.678187H409.167092a115.272452 115.272452 0 0 0-110.924676 83.685295v-51.872604c0-97.492929 80.628068-177.268984 179.173485-177.268984h67.659918c98.507828 0 179.135897 79.776055 179.135896 177.268984z",fill:"#7F6152","p-id":"2335"}),t("path",{d:"M440.228006 231.847984m54.215641 0l33.566837 0q54.215641 0 54.215641 54.215642l0 11.853015q0 54.215641-54.215641 54.215641l-33.566837 0q-54.215641 0-54.215641-54.215641l0-11.853015q0-54.215641 54.215641-54.215642Z",fill:"#7F6152","p-id":"2336"}),t("path",{d:"M605.192908 582.952838c-16.288499 0-32.990475 14.62206-32.990474 14.62206l69.752363-2.092446s-20.47339-12.529614-36.761889-12.529614zM380.499334 595.482452l69.752363 2.092446s-16.714506-14.62206-33.003004-14.62206-36.749359 12.529614-36.749359 12.529614z",fill:"#262626","p-id":"2337"}),t("path",{d:"M518.525566 597.574898v91.466185l19.195369-4.786313-19.195369-86.679872z",fill:"#F2B2B1","p-id":"2338"}),t("path",{d:"M665.347587 538.898714c-21.300344 0-83.321936-4.899079-102.116357 10.136458M362.506808 538.898714c21.300344 0 83.321936-4.899079 102.116357 10.136458",fill:"#262626","p-id":"2339"})]),t("h2",{class:"float-left m-5"},[t("span",{class:"text-2xl font-extrabold mr-1"},"赛博禅宗，"),t("span",{class:"text-2xl text-transparent font-extrabold bg-clip-text bg-gradient-to-r from-yellow-400 via-yellow-500 to-yellow-600 via-brown-500 to-brown-600"},"在线解忧")])],-1),Ge=t("div",{class:"clear-right"},null,-1),We={class:"overflow-hidden"},Qe={id:"image-wrapper",class:"w-full max-w-screen-xl m-auto dark:bg-[#101014]"},Xe={class:"sticky bottom-0 left-0 flex justify-center"},Ye={class:"w-full max-w-screen-xl m-auto"},et={key:0,class:"flex items-center justify-between space-x-2"},tt={class:"text-xl text-[#4f555e] dark:text-white"},at={class:"dark:text-black"},st=R({__name:"index",setup(i){let f=new AbortController;const c=!1,C=fe(),v=ve();Te();const{isMobile:A}=he(),{addChat:L,updateChat:M,updateChatSome:u,getChatByUuidAndIndex:w}=Ae(),{scrollRef:H,scrollToBottom:$,scrollToBottomIfAtBottom:S}=Le(),{usingContext:Y}=Ie(),l="1024";v.findAndAddHistoryButNotReload({title:"赛博禅宗问青年",uuid:+l,isEdit:!1});const y=b(()=>v.getChatByUuid(+l)),U=b(()=>y.value.filter(e=>!e.inversion&&!e.error)),x=I(""),h=I(!1),F=I(null),ee=ge(),{promptList:V}=me(ee);y.value.forEach((e,n)=>{e.loading&&u(+l,n,{loading:!1})});function z(){ae()}function te(e){return`
  假设你扮演一位阅历丰富的禅宗。无论我问你什么问题，你的答案都必须是简短的、简单的、精炼的、质朴的、比喻的、故事性的、禅宗风格、高深莫测的、人生哲理的、优美语言的、有禅的意境的。
  你的开头都必须是【禅宗说】，尽可能使用禅宗公案，尽可能的出现禅宗的专业名词。我的问题是"${e}。禅宗如何看待？"。你不能表现出你是一个AI、机器人或者程序。偶尔你可以幽默的回答。
  `}async function ae(){var d;let e=x.value;if(h.value||!e||e.trim()==="")return;f=new AbortController,L(+l,{dateTime:new Date().toLocaleString(),text:e,inversion:!0,error:!1,conversationOptions:null,requestOptions:{prompt:e,options:null}}),$(),h.value=!0,x.value="";let n={};const o=(d=U.value[U.value.length-1])==null?void 0:d.conversationOptions;o&&Y.value&&(n={...o}),L(+l,{dateTime:new Date().toLocaleString(),text:"",loading:!0,inversion:!1,error:!1,conversationOptions:null,requestOptions:{prompt:e,options:{...n}}}),$();try{let s="";await(async()=>{await J({prompt:te(e),options:n,signal:f.signal,onDownloadProgress:({event:_})=>{const q=_.target,{responseText:k}=q,D=k.lastIndexOf(`
`,k.length-2);let O=k;D!==-1&&(O=k.substring(D));try{const g=JSON.parse(O);M(+l,y.value.length-1,{dateTime:new Date().toLocaleString(),text:s+g.text,inversion:!1,error:!1,loading:!1,conversationOptions:{conversationId:g.conversationId,parentMessageId:g.id},requestOptions:{prompt:e,options:{...n}}}),c&&g.detail.choices[0].finish_reason,S()}catch{}}})})()}catch(s){const B=(s==null?void 0:s.message)??m("common.wrong");if(s.message==="canceled"){u(+l,y.value.length-1,{loading:!1}),S();return}const _=w(+l,y.value.length-1);if(_!=null&&_.text&&_.text!==""){u(+l,y.value.length-1,{text:`${_.text}
[${B}]`,error:!1,loading:!1});return}M(+l,y.value.length-1,{dateTime:new Date().toLocaleString(),text:B,inversion:!1,error:!0,loading:!1,conversationOptions:null,requestOptions:{prompt:e,options:{...n}}}),S()}finally{h.value=!1}}async function ne(e){if(h.value)return;f=new AbortController;const{requestOptions:n}=y.value[e];let o=(n==null?void 0:n.prompt)??"",d={};n.options&&(d={...n.options}),h.value=!0,M(+l,e,{dateTime:new Date().toLocaleString(),text:"",inversion:!1,error:!1,loading:!0,conversationOptions:null,requestOptions:{prompt:o,...d}});try{let s="";await(async()=>{await J({prompt:o,options:d,signal:f.signal,onDownloadProgress:({event:_})=>{const q=_.target,{responseText:k}=q,D=k.lastIndexOf(`
`,k.length-2);let O=k;D!==-1&&(O=k.substring(D));try{const g=JSON.parse(O);M(+l,e,{dateTime:new Date().toLocaleString(),text:s+g.text,inversion:!1,error:!1,loading:!1,conversationOptions:{conversationId:g.conversationId,parentMessageId:g.id},requestOptions:{prompt:o,...d}}),c&&g.detail.choices[0].finish_reason}catch{}}})})()}catch(s){if(s.message==="canceled"){u(+l,e,{loading:!1});return}const B=(s==null?void 0:s.message)??m("common.wrong");M(+l,e,{dateTime:new Date().toLocaleString(),text:B,inversion:!1,error:!0,loading:!1,conversationOptions:null,requestOptions:{prompt:o,...d}})}finally{h.value=!1}}function oe(e){h.value||C.warning({title:m("chat.deleteMessage"),content:m("chat.deleteMessageConfirm"),positiveText:m("common.yes"),negativeText:m("common.no"),onPositiveClick:()=>{v.deleteChatByUuid(+l,e)}})}function se(){h.value||C.warning({title:m("chat.clearChat"),content:m("chat.clearChatConfirm"),positiveText:m("common.yes"),negativeText:m("common.no"),onPositiveClick:()=>{v.clearChatByUuid(+l)}})}function le(e){A.value?e.key==="Enter"&&e.ctrlKey&&(e.preventDefault(),z()):e.key==="Enter"&&!e.shiftKey&&(e.preventDefault(),z())}const re=b(()=>x.value.startsWith("/")?V.value.filter(e=>e.key.toLowerCase().includes(x.value.substring(1).toLowerCase())).map(e=>({label:e.value,value:e.value})):[]),ie=e=>{for(const n of V.value)if(n.value===e.label)return[n.key];return[]},ce=b(()=>"诉说你的苦恼，追寻人生的意义"),de=b(()=>h.value||!x.value||x.value.trim()===""),ue=b(()=>{let e=["p-4"];return A.value&&(e=["sticky","left-0","bottom-0","right-0","p-2","pr-3","overflow-hidden"]),e});return xe(()=>{var e;$(),F.value&&!A.value&&((e=F.value)==null||e.focus())}),we(()=>{h.value&&f.abort()}),(e,n)=>(r(),p("div",Ke,[Je,Ge,t("main",We,[t("div",{id:"scrollRef",ref_key:"scrollRef",ref:H,class:"h-full overflow-hidden overflow-y-auto"},[t("div",Qe,[t("div",null,[(r(!0),p(X,null,ye(a(y),(o,d)=>(r(),P(je,{key:d,"date-time":o.dateTime,text:o.text,inversion:o.inversion,error:o.error,loading:o.loading,onRegenerate:s=>ne(d),onDelete:s=>oe(d)},null,8,["date-time","text","inversion","error","loading","onRegenerate","onDelete"]))),128)),t("div",Xe,[K("",!0)])])])],512)]),t("footer",{class:Z(a(ue))},[t("div",Ye,[h.value?K("",!0):(r(),p("div",et,[T(a($e),{onClick:se},{default:E(()=>[t("span",tt,[T(a(G),{icon:"ri:delete-bin-line"})])]),_:1}),T(a(De),{value:x.value,"onUpdate:value":n[1]||(n[1]=o=>x.value=o),options:a(re),"render-label":ie},{default:E(({handleInput:o,handleBlur:d,handleFocus:s})=>[T(a(_e),{ref_key:"inputRef",ref:F,value:x.value,"onUpdate:value":n[0]||(n[0]=B=>x.value=B),type:"textarea",placeholder:a(ce),autosize:{minRows:1,maxRows:a(A)?4:8},onInput:o,onFocus:s,onBlur:d,onKeypress:le},null,8,["value","placeholder","autosize","onInput","onFocus","onBlur"])]),_:1},8,["value","options"]),T(a(ke),{type:"primary",disabled:a(de),onClick:z},{icon:E(()=>[t("span",at,[T(a(G),{icon:"ri:send-plane-fill"})])]),_:1},8,["disabled"])]))])],2)]))}});export{st as _};
