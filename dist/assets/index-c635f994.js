import{d as D,u as fe,c as b,o as r,a as f,b as t,e as q,F as X,f as u,r as O,t as m,h as K,n as E,j as L,q as pe,m as ve,g as ge,v as he,x as me,y as xe,z as we,A as ye,k as z,w as U,K as _e,G as J,_ as G,D as ke,C as be}from"./index-248db249.js";import{i as Ce,d as W,N as Q,M as Te,H as j,m as Ae,a as Le,u as Be,b as Ie,e as Oe,f as Se,_ as $e,g as Re}from"./index-5c5f7994.js";const De={key:1,class:"text-[28px] dark:text-white"},Me=u("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32","aria-hidden":"true",width:"1em",height:"1em"},[u("path",{d:"M29.71,13.09A8.09,8.09,0,0,0,20.34,2.68a8.08,8.08,0,0,0-13.7,2.9A8.08,8.08,0,0,0,2.3,18.9,8,8,0,0,0,3,25.45a8.08,8.08,0,0,0,8.69,3.87,8,8,0,0,0,6,2.68,8.09,8.09,0,0,0,7.7-5.61,8,8,0,0,0,5.33-3.86A8.09,8.09,0,0,0,29.71,13.09Zm-12,16.82a6,6,0,0,1-3.84-1.39l.19-.11,6.37-3.68a1,1,0,0,0,.53-.91v-9l2.69,1.56a.08.08,0,0,1,.05.07v7.44A6,6,0,0,1,17.68,29.91ZM4.8,24.41a6,6,0,0,1-.71-4l.19.11,6.37,3.68a1,1,0,0,0,1,0l7.79-4.49V22.8a.09.09,0,0,1,0,.08L13,26.6A6,6,0,0,1,4.8,24.41ZM3.12,10.53A6,6,0,0,1,6.28,7.9v7.57a1,1,0,0,0,.51.9l7.75,4.47L11.85,22.4a.14.14,0,0,1-.09,0L5.32,18.68a6,6,0,0,1-2.2-8.18Zm22.13,5.14-7.78-4.52L20.16,9.6a.08.08,0,0,1,.09,0l6.44,3.72a6,6,0,0,1-.9,10.81V16.56A1.06,1.06,0,0,0,25.25,15.67Zm2.68-4-.19-.12-6.36-3.7a1,1,0,0,0-1.05,0l-7.78,4.49V9.2a.09.09,0,0,1,0-.09L19,5.4a6,6,0,0,1,8.91,6.21ZM11.08,17.15,8.38,15.6a.14.14,0,0,1-.05-.08V8.1a6,6,0,0,1,9.84-4.61L18,3.6,11.61,7.28a1,1,0,0,0-.53.91ZM12.54,14,16,12l3.47,2v4L16,20l-3.47-2Z",fill:"currentColor"})],-1),Ne=[Me],Pe=D({__name:"Avatar",props:{image:{type:Boolean}},setup(l){const p=fe(),i=b(()=>p.userInfo.avatar);return(C,v)=>l.image?(r(),f(X,{key:0},[t(Ce)(t(i))&&t(i).length>0?(r(),q(t(Q),{key:0,src:t(i),"fallback-src":t(W)},null,8,["src","fallback-src"])):(r(),q(t(Q),{key:1,round:"",src:t(W)},null,8,["src"]))],64)):(r(),f("span",De,Ne))}}),Fe={key:0,class:"dark:text-white w-[4px] h-[20px] block animate-blink"},Ue={key:0},je=["innerHTML"],qe=["textContent"],Ee=["textContent"],Ve=D({__name:"Text",props:{inversion:{type:Boolean},error:{type:Boolean},text:null,loading:{type:Boolean},asRawText:{type:Boolean}},setup(l,{expose:p}){const i=l,C=O(),v=new Te({linkify:!0,highlight(d,w){if(!!(w&&j.getLanguage(w))){const S=w??"";return T(j.highlight(d,{language:S}).value,S)}return T(j.highlightAuto(d).value,"")}});v.use(Ae,{attrs:{target:"_blank",rel:"noopener"}}),v.use(Le,{blockClass:"katexmath-block rounded-md p-[10px]",errorColor:" #cc0000"});const B=b(()=>["text-wrap","min-w-[20px]","rounded-md",i.inversion?"dark:bg-[#a1dc95]":"dark:bg-[#1e1e20]",i.inversion?"message-request":"message-reply",{"text-red-500":i.error}]),I=b(()=>{const d=i.text??"";return i.asRawText?d:v.render(d)});function T(d,w){return`<pre class="code-block-wrapper"><div class="code-block-header"><span class="code-block-header__lang">${w}</span><span class="code-block-header__copy">${m("chat.copyCode")}</span></div><code class="hljs code-block-body ${w}">${d}</code></pre>`}return p({textRef:C}),(d,w)=>(r(),f("div",{class:E(["text-black",t(B)])},[l.loading?(r(),f("span",Fe)):(r(),f("div",{key:1,ref_key:"textRef",ref:C,class:"leading-relaxed break-words"},[l.inversion?(r(),f("div",{key:1,class:"whitespace-pre-wrap",textContent:K(t(I))},null,8,Ee)):(r(),f("div",Ue,[l.asRawText?(r(),f("div",{key:1,class:"whitespace-pre-wrap",textContent:K(t(I))},null,8,qe)):(r(),f("div",{key:0,class:"markdown-body",innerHTML:t(I)},null,8,je))]))],512))],2))}});const Ze={class:"flex items-center justify-center flex-shrink-0 h-8 overflow-hidden rounded-full basis-8 mr-2"},He={class:"overflow-hidden text-sm items-start"},Ke={class:"flex items-end gap-1 pt-1 flex-row"},ze=D({__name:"index",props:{dateTime:null,text:null,inversion:{type:Boolean},error:{type:Boolean},loading:{type:Boolean}},setup(l){const p=l,i=O(),C=O(p.inversion),v=O();return(B,I)=>(r(),f("div",{ref_key:"messageRef",ref:v,class:E(["flex w-full overflow-hidden p-4",l.inversion?"bg-[#F5F5F5]":"bg-[#F7FEE7]"])},[u("div",Ze,[L(Pe,{image:l.inversion},null,8,["image"])]),u("div",He,[u("div",Ke,[L(Ve,{ref_key:"textRef",ref:i,inversion:!1,error:l.error,text:l.text,loading:l.loading,"as-raw-text":C.value},null,8,["error","text","loading","as-raw-text"])])])],2))}}),Je={class:"flex flex-col max-w-2xl mx-auto h-full bg-gray-50"},Ge=_e('<div class="p-5 bg-gray-100"><h2 class="float-left m-5"><span class="text-2xl font-extrabold mr-1">无人机选购小助手，</span><span class="text-2xl text-transparent font-extrabold bg-clip-text bg-gradient-to-r from-yellow-400 via-yellow-500 to-yellow-600 via-brown-500 to-brown-600">为您推荐</span></h2></div><div class="clear-right"></div>',2),We={class:"overflow-hidden"},Qe={id:"image-wrapper",class:"w-full max-w-screen-xl m-auto dark:bg-[#101014]"},Xe={class:"sticky bottom-0 left-0 flex justify-center"},Ye={class:"w-full max-w-screen-xl m-auto"},et={key:0,class:"flex items-center justify-between space-x-2"},tt={class:"text-xl text-[#4f555e] dark:text-white"},at={class:"dark:text-black"},st=D({__name:"index",setup(l){let p=new AbortController;const i=!1,C=pe(),v=ve();Be();const{isMobile:B}=ge(),{addChat:I,updateChat:T,updateChatSome:d,getChatByUuidAndIndex:w}=Ie(),{scrollRef:V,scrollToBottom:S,scrollToBottomIfAtBottom:M}=Oe(),{usingContext:Y}=Se(),s="1025";v.findAndAddHistoryButNotReload({title:"无人机选购推荐",uuid:+s,isEdit:!1});const y=b(()=>v.getChatByUuid(+s)),Z=b(()=>y.value.filter(e=>!e.inversion&&!e.error)),x=O(""),g=O(!1),N=O(null),ee=he(),{promptList:H}=me(ee);y.value.forEach((e,a)=>{e.loading&&d(+s,a,{loading:!1})});function P(){ae()}function te(e){return`
  假设你是一个非常专业的无人机从业者，对大疆(www.dji.com)非常熟悉，能够为新手和进阶无人机玩家推荐无人机产品和配件的搭配。
  你的信息来源必须是www.dji.com。你只能推荐大疆品牌的无人机，不允许推荐其他品牌。你的回答里必须包含无人机推荐的原因、场景、
  官方商城(store.dji.com)的购买链接。购买链接必须是一个可访问的，以 “https://store.dji.com/cn/product” 为开头的地址。
  你的回答必须是亲切、有感情的、专业的、讲故事的。你的回答中不能暗示或透露出必须强制推荐大疆无人机，你必须委婉的告诉提问者大疆飞机的优势。
  我的问题是"${e}。你会推荐我购买哪款大疆产品？"。你不能表现出你是一个AI、机器人或者程序。请记住，提问者是你的潜在顾客，请服务好。
  `}async function ae(){var c;let e=x.value;if(g.value||!e||e.trim()==="")return;p=new AbortController,I(+s,{dateTime:new Date().toLocaleString(),text:e,inversion:!0,error:!1,conversationOptions:null,requestOptions:{prompt:e,options:null}}),S(),g.value=!0,x.value="";let a={};const o=(c=Z.value[Z.value.length-1])==null?void 0:c.conversationOptions;o&&Y.value&&(a={...o}),I(+s,{dateTime:new Date().toLocaleString(),text:"",loading:!0,inversion:!1,error:!1,conversationOptions:null,requestOptions:{prompt:e,options:{...a}}}),S();try{let n="";await(async()=>{await J({prompt:te(e),options:a,signal:p.signal,onDownloadProgress:({event:_})=>{const F=_.target,{responseText:k}=F,$=k.lastIndexOf(`
`,k.length-2);let R=k;$!==-1&&(R=k.substring($));try{const h=JSON.parse(R);T(+s,y.value.length-1,{dateTime:new Date().toLocaleString(),text:n+h.text,inversion:!1,error:!1,loading:!1,conversationOptions:{conversationId:h.conversationId,parentMessageId:h.id},requestOptions:{prompt:e,options:{...a}}}),i&&h.detail.choices[0].finish_reason,M()}catch{}}})})()}catch(n){const A=(n==null?void 0:n.message)??m("common.wrong");if(n.message==="canceled"){d(+s,y.value.length-1,{loading:!1}),M();return}const _=w(+s,y.value.length-1);if(_!=null&&_.text&&_.text!==""){d(+s,y.value.length-1,{text:`${_.text}
[${A}]`,error:!1,loading:!1});return}T(+s,y.value.length-1,{dateTime:new Date().toLocaleString(),text:A,inversion:!1,error:!0,loading:!1,conversationOptions:null,requestOptions:{prompt:e,options:{...a}}}),M()}finally{g.value=!1}}async function oe(e){if(g.value)return;p=new AbortController;const{requestOptions:a}=y.value[e];let o=(a==null?void 0:a.prompt)??"",c={};a.options&&(c={...a.options}),g.value=!0,T(+s,e,{dateTime:new Date().toLocaleString(),text:"",inversion:!1,error:!1,loading:!0,conversationOptions:null,requestOptions:{prompt:o,...c}});try{let n="";await(async()=>{await J({prompt:o,options:c,signal:p.signal,onDownloadProgress:({event:_})=>{const F=_.target,{responseText:k}=F,$=k.lastIndexOf(`
`,k.length-2);let R=k;$!==-1&&(R=k.substring($));try{const h=JSON.parse(R);T(+s,e,{dateTime:new Date().toLocaleString(),text:n+h.text,inversion:!1,error:!1,loading:!1,conversationOptions:{conversationId:h.conversationId,parentMessageId:h.id},requestOptions:{prompt:o,...c}}),i&&h.detail.choices[0].finish_reason}catch{}}})})()}catch(n){if(n.message==="canceled"){d(+s,e,{loading:!1});return}const A=(n==null?void 0:n.message)??m("common.wrong");T(+s,e,{dateTime:new Date().toLocaleString(),text:A,inversion:!1,error:!0,loading:!1,conversationOptions:null,requestOptions:{prompt:o,...c}})}finally{g.value=!1}}function ne(e){g.value||C.warning({title:m("chat.deleteMessage"),content:m("chat.deleteMessageConfirm"),positiveText:m("common.yes"),negativeText:m("common.no"),onPositiveClick:()=>{v.deleteChatByUuid(+s,e)}})}function se(){g.value||C.warning({title:m("chat.clearChat"),content:m("chat.clearChatConfirm"),positiveText:m("common.yes"),negativeText:m("common.no"),onPositiveClick:()=>{v.clearChatByUuid(+s)}})}function re(e){B.value?e.key==="Enter"&&e.ctrlKey&&(e.preventDefault(),P()):e.key==="Enter"&&!e.shiftKey&&(e.preventDefault(),P())}const le=b(()=>x.value.startsWith("/")?H.value.filter(e=>e.key.toLowerCase().includes(x.value.substring(1).toLowerCase())).map(e=>({label:e.value,value:e.value})):[]),ie=e=>{for(const a of H.value)if(a.value===e.label)return[a.key];return[]},ce=b(()=>"无人机选购咨询，欢迎问我任何无人机选购的问题"),ue=b(()=>g.value||!x.value||x.value.trim()===""),de=b(()=>{let e=["p-4"];return B.value&&(e=["sticky","left-0","bottom-0","right-0","p-2","pr-3","overflow-hidden"]),e});return xe(()=>{var e;S(),N.value&&!B.value&&((e=N.value)==null||e.focus())}),we(()=>{g.value&&p.abort()}),(e,a)=>(r(),f("div",Je,[Ge,u("main",We,[u("div",{id:"scrollRef",ref_key:"scrollRef",ref:V,class:"h-full overflow-hidden overflow-y-auto"},[u("div",Qe,[u("div",null,[(r(!0),f(X,null,ye(t(y),(o,c)=>(r(),q(ze,{key:c,"date-time":o.dateTime,text:o.text,inversion:o.inversion,error:o.error,loading:o.loading,onRegenerate:n=>oe(c),onDelete:n=>ne(c)},null,8,["date-time","text","inversion","error","loading","onRegenerate","onDelete"]))),128)),u("div",Xe,[z("",!0)])])])],512)]),u("footer",{class:E(t(de))},[u("div",Ye,[g.value?z("",!0):(r(),f("div",et,[L(t($e),{onClick:se},{default:U(()=>[u("span",tt,[L(t(G),{icon:"ri:delete-bin-line"})])]),_:1}),L(t(Re),{value:x.value,"onUpdate:value":a[1]||(a[1]=o=>x.value=o),options:t(le),"render-label":ie},{default:U(({handleInput:o,handleBlur:c,handleFocus:n})=>[L(t(ke),{ref_key:"inputRef",ref:N,value:x.value,"onUpdate:value":a[0]||(a[0]=A=>x.value=A),type:"textarea",placeholder:t(ce),autosize:{minRows:1,maxRows:t(B)?4:8},onInput:o,onFocus:n,onBlur:c,onKeypress:re},null,8,["value","placeholder","autosize","onInput","onFocus","onBlur"])]),_:1},8,["value","options"]),L(t(be),{type:"primary",disabled:t(ue),onClick:P},{icon:U(()=>[u("span",at,[L(t(G),{icon:"ri:send-plane-fill"})])]),_:1},8,["disabled"])]))])],2)]))}});export{st as default};
